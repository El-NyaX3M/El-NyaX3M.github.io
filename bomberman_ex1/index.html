<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
        <canvas id="canvas" height="850" width="1250">
            Su navegador no soporta Canvas.
        </canvas>

        <script>
            var canvas, context;
            var direction;
            var margin = [], solids = [], block = [];
            var player;

            function run(){
                canvas = document.getElementById("canvas");
                context = canvas.getContext("2d");
                direction = "down";
                var i = 0;
                for(var x = 0; x < 1050; x += 50){
                    for(var y = 0; y < 850; y += 50){
                        if(y == 0 || y == 800){
                            solids[i] = new entity(x, y, 50, 50, "gray");
                            i++;
                        }
                        else if(x == 0 || x == 1000){
                            solids[i] = new entity(x, y, 50, 50, "gray");
                            i++;
                        }
                    }
                }
                
                for(var x = 100; x < 950; x += 100){
                    for(var y = 100; y < 750; y += 100){
                        solids[i] = new entity(x, y, 50, 50);
                        i++;
                    }
                }
                i = 0;
                for(var x = 50; x < 1000; x += 50){
                    for(var y = 50; y < 800; y += 50){
                        if((x == 50 && y == 50) ||
                        (x == 100 && y == 50) ||
                        (x == 50 && y == 100)){
                            //estos son espacios vacÃ­os que deben estar
                        }
                        else if((x == 150 && y == 50) ||
                        (x == 50 && y == 150)){
                            //estos son bloques destruibles que deben estar
                            block[i] = new entity(x, y, 50, 50, "rgb(200, 100, 150)");
                            i++;
                        }
                        else{
                            var flag = false
                            for(var val of solids){
                                if(x == val.x && y == val.y){
                                    flag = true;
                                    break;
                                }
                            }
                            if(!flag){
                                var random = Math.round(Math.random() * 3);
                                if(random == 1){
                                    block[i] = new entity(x, y, 50, 50, "rgb(200, 100, 150)");
                                    i++;
                                }
                            }
                            console.log("si" + random);
                        }
                    }
                }
                player = new entity(50, 50, 50, 50, "white");
                paint();
            }
            function update(){
                for(var val of solids){
                    if(player.se_tocan(val)){
                        switch(direction){
                            case "up":
                                
                                player.y += 50;
                                break;

                            case "left":  
                                
                                player.x += 50;
                                break;

                            case "down":
                                
                                player.y -= 50;
                                break;

                            case "right":
                                
                                player.x -= 50;
                                break;
                        }
                    }
                }
            }

            function paint(){

                window.requestAnimationFrame(paint);
                context.fillStyle = "green";
                context.fillRect(0, 0, 1050, 850);

                context.fillStyle = "rgb(200,200,200)";
                context.fillRect(1050, 0, 200,850); 

                player.paint(context);
                
                for(var i = 0; i < margin.length; i++){
                    margin[i].paint(context);
                }
                for(var i = 0; i < solids.length; i++){
                    solids[i].paint(context);
                }
                for(var i = 0; i < block.length; i++){
                    block[i].paint(context);
                }
                


                update();
            }

            function entity(x,y,height,width,color){
                this.x = x;
                this.y = y;
                this.height = height;
                this.width = width;
                this.color = color;

                this.paint = function(context){
                    context.fillStyle = this.color;
                    context.fillRect(this.x, this.y, this.width, this.height);
                    context.strokeRect(this.x, this.y, this.width, this.height);
                }

                this.se_tocan = function (target) { 
                    if(this.x < target.x + target.width &&
                    this.x + this.width > target.x && 
                    this.y < target.y + target.height && 
                    this.y + this.height > target.y){
                        return true;
                    }
                }
            }
            
            document.addEventListener("keydown",function(e){
                switch(e.key){
                    case "w":
                        direction = "up";
                        player.y -= 50;
                        break;

                    case "a":  
                        direction = "left";
                        player.x -= 50;
                        break;

                    case "s":
                        direction = "down";
                        player.y += 50;
                        break;

                    case "d":
                        direction = "right";
                        player.x += 50;
                        break;
                }
            })

            window.addEventListener("load", run, false);
            window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
            }());
        </script>
</body>
</html>